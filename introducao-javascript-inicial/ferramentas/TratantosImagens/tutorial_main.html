<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8" /> 
    <title>Jcrop &raquo; Tutorials &raquo; Animations / Transitions</title>
    <script src="./js/jquery.min.js" type="text/javascript"></script>
    <script src="./js/jquery.Jcrop.js" type="text/javascript"></script>
    <script src="./js/jquery.color.js" type="text/javascript"></script>
    <link rel="stylesheet" href="./css/jquery.Jcrop.css" type="text/css" />
    <link rel="stylesheet" href="./css/jquery.Jcrop.extras.css" type="text/css" />
    <link rel="stylesheet" href="demo_files/demos.css" type="text/css" />

    <script type="text/javascript">

      jQuery(function($){



        $("#photo_id").change(function () {

          let uploadedImg = $('#photo_id');// [0].files[0].name e [0].files.length
          let uploadedImgType = $('#photo_id').val();
          let filename = uploadedImgType.replace(/C:\\fakepath\\/i, '')

          if(filename != "" && filename.length > 0){
              if(uploadedImgType.match(/(?:jpeg|jpg|png|tif|tiff)$/) && (uploadedImg[0].files[0].size/1000/1000 < 50)){
                  console.log('uploadedImgType', uploadedImgType);
                  if (this.files && this.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                      var jcrop_api;

                      // $('#imgshow').Jcrop({
                      //   bgFade:     true,
                      //   bgOpacity: .3,
                      //   setSelect: [ 20,20,580,380 ] // dimensão da imagem
                      // },function(){
                      //   jcrop_api = this;
                      // });

                      // // Define page sections
                      // var sections = {
                      //   bgo_buttons: 'Change bgOpacity',
                      //   bgc_buttons: 'Change bgColor'
                      // };
                      // // Define bgOpacity buttons
                      // var bgo = {
                      //   Low: .2,
                      //   Mid: .5,
                      //   High: .8,
                      //   Full: 1
                      // };
                      // // Define bgColor buttons
                      // var bgc = {
                      //   Red: '#900',
                      //   Blue: '#4BB6F0',
                      //   Yellow: '#F0B207',
                      //   Green: '#46B81C',
                      //   White: 'white',
                      //   Black: 'black'
                      // };
                      // // Create fieldset targets for buttons
                      // for(i in sections)
                      //   insertSection(i,sections[i]);
                      // // Create bgOpacity buttons
                      // for(i in bgo) {
                      //   $('#bgo_buttons').append(
                      //     $('<button />').append(i).click(setoptHandler('bgOpacity',bgo[i])), ' '
                      //   );
                      // }
                      // // Create bgColor buttons
                      // for(i in bgc) {
                      //   $('#bgc_buttons').append(
                      //     $('<button />').append(i).css({
                      //       backgroundColor: bgc[i],
                      //       color: ((i == 'Black') || (i == 'Red'))?'white':'black'
                      //     }).click(setoptHandler('bgColor',bgc[i])), ' '
                      //   );
                      // }
                      // // Function to insert named sections into interface
                      // function insertSection(k,v) {
                      //   $('#interface').append(
                      //     $('<fieldset></fieldset>').attr('id',k).append(
                      //       $('<legend></legend>').append(v)
                      //     )
                      //   );
                      // };
                      // // Handler for option-setting buttons
                      // function setoptHandler(k,v) {
                      //   return function() {
                      //     var opt = { };
                      //     opt[k] = v;
                      //     jcrop_api.setOptions(opt);
                      //     return false;
                      //   };
                      // };
                      // // Handler for animation buttons
                      // function animHandler(v) {
                      //   return function() {
                      //     jcrop_api.animateTo(v);
                      //     return false;
                      //   };
                      // };

                      $('#interface').show();

                      $('#imgshow').attr('src', e.target.result);
                    }
                    reader.readAsDataURL(this.files[0]);
                    $("#imgshow").show();

                    setTimeout(async () => {
                      const img =  document.getElementById('imgshow');
                      getImgSize(img).then(size => {

                        $('#imgshow').Jcrop({
                          bgFade:     true,
                          bgOpacity: .3,
                          setSelect: [ 0, 0, size.width, size.height ] 
                          // setSelect: [ size.height / 20 ,size.height / 20 ,size.width - 22 ,size.width - 222 ] // dimensão da imagem
                        },function(){
                          jcrop_api = this;
                        });

                        console.log(size.width - 22, size.width - 222 , size.height / 20 , size.height / 20, size  )
                      });

                    }, 80)
                  }
              }else{
                console.log('ERRO-uploadedImgType-ERRO');
              }
          }
        });

        function getImgSize(image) {
          const newImg = new Image();
          return new Promise((res, rej) => {
            newImg.onload = function() {
              const height = newImg.height;
              const width = newImg.width;
              res({
                width: newImg.width,
                height: newImg.height
              });
            }
            newImg.src = image.src;
          });
        }

      });

    </script>

  </head>

  <body>
    <div id="outer">
    <div class="jcExample">
    <div class="article">


      <h1>Exemplo ded imagens</h1>
      <img src="#" id="imgshow" alt="Flowers"> 
    

      <div id="interface" style="margin: 1em 0;"></div>
    
      <input type="file" id="photo_id" name="filename" accept="image/png, image/jpeg">
      

    </div>
    </div>
    </div>
  </body>
</html>

